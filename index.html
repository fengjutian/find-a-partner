<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>多候选人相配度系统（硬条件版）</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial; padding:20px; background:#f0f2f5; }
h2,h3 { margin-top:20px; }
input[type=number], input[type=text] { width:120px; margin-right:10px; }
.slider-container{ margin-bottom:8px; color:#000; }
#dashboard { display:flex; flex-wrap:wrap; gap:20px; margin-top:20px; }
.card { border-radius:12px; padding:15px; width:320px; box-shadow:0 4px 8px rgba(0,0,0,0.1); text-align:center; transition:0.3s; color:#fff;}
.card h4{ margin:0 0 10px 0; }
.card .score{ font-weight:bold; margin-bottom:10px; font-size:18px; }
</style>
</head>
<body>

<h2>多候选人相配度系统（含硬条件惩罚）</h2>

<h3>1. 设置维度权重</h3>
<div id="sliders"></div>

<h3>2. 添加候选人</h3>
<button onclick="addCandidate()">添加候选人</button>
<table id="candidatesTable" style="display:none;"><tbody></tbody></table>

<h3>3. 仪表盘显示匹配度</h3>
<div id="dashboard"></div>

<script>
const dimensions=[
  {name:'年龄',type:'number'},
  {name:'身高',type:'number'},
  {name:'性格',type:'text'},
  {name:'教育',type:'text'},
  {name:'兴趣',type:'interests'},
  {name:'收入',type:'number'},
  {name:'居住城市',type:'text'},
  {name:'生活习惯',type:'text'}
];

const targetPerson={
  name:'目标对象',
  age:30,
  height:175,
  personality:'外向',
  education:'本科',
  interests:'羽毛球,旅游,悬疑电影',
  income:15000,
  city:'南京',
  habit:'早睡,运动'
};

// 硬条件设置
const hardConditions = {
  '年龄': {maxDiff:5, factor:0.5},      // 年龄差>5惩罚
  '身高': {min:175, factor:0.5},       // 身高<175惩罚
  '居住城市': {value:'南京', factor:0.5} // 不同城市惩罚
};

let charts=[];

function initSliders(){
  const container=document.getElementById('sliders');
  container.innerHTML='';
  dimensions.forEach(dim=>{
    const div=document.createElement('div');
    div.className='slider-container';
    div.innerHTML=`${dim.name} 权重: <span id="weight_${dim.name}_val">5</span>
      <input type="range" min="0" max="10" value="5" id="weight_${dim.name}" oninput="updateDashboard()">`;
    container.appendChild(div);
  });
}

// 添加候选人
function addCandidate(name='候选人'){
  const tbody=document.querySelector("#candidatesTable tbody");
  const row=document.createElement("tr");
  row.innerHTML=`<td><input type="text" value="${name}" oninput="updateDashboard()"></td>`;
  dimensions.forEach(dim=>{
    let defaultVal=dim.type==='number'?5:'';
    row.innerHTML+=`<td><input type="${dim.type==='number'?'number':'text'}" value="${defaultVal}" oninput="updateDashboard()"></td>`;
  });
  row.innerHTML+=`<td><button onclick="removeCandidate(this)">删除</button></td>`;
  tbody.appendChild(row);
  updateDashboard();
}
function removeCandidate(btn){ btn.closest("tr").remove(); updateDashboard(); }

// 兴趣匹配
function interestScore(target, candidate){
  const list1=target.split(',').map(s=>s.trim());
  const list2=candidate.split(',').map(s=>s.trim());
  const match=list1.filter(x=>list2.includes(x));
  return Math.min(match.length/list1.length*10,10);
}

// 生活习惯匹配
function habitScore(target, candidate){
  if(!target || !candidate) return 0;
  const list1=target.split(',').map(s=>s.trim());
  const list2=candidate.split(',').map(s=>s.trim());
  const match=list1.filter(x=>list2.includes(x));
  return Math.min(match.length/list1.length*10,10);
}

// 计算每个维度分数
function calculateScores(candidate){
  const scores={};
  scores['年龄']=Math.max(0,10-Math.abs(targetPerson.age-parseFloat(candidate['年龄']||0)));
  scores['身高']=Math.max(0,10-Math.abs(targetPerson.height-parseFloat(candidate['身高']||0))/2);
  scores['性格']=candidate['性格']===targetPerson.personality?10:5;
  scores['教育']=candidate['教育']===targetPerson.education?10:5;
  scores['兴趣']=interestScore(targetPerson.interests,candidate['兴趣']||'');
  scores['收入']=Math.max(0,10-Math.abs(targetPerson.income-parseFloat(candidate['收入']||0))/5000);
  scores['居住城市']=candidate['居住城市']===targetPerson.city?10:0;
  scores['生活习惯']=habitScore(targetPerson.habit,candidate['生活习惯']||'');
  return scores;
}

// 计算总匹配度（含硬条件惩罚）
function calculateTotal(scores, candidate){
  let total=0, weightSum=0;
  dimensions.forEach(dim=>{
    const w=parseFloat(document.getElementById(`weight_${dim.name}`).value);
    document.getElementById(`weight_${dim.name}_val`).innerText=w;
    total+=scores[dim.name]*w;
    weightSum+=10*w;
  });
  let score=weightSum>0?(total/weightSum*100):0;

  // 应用硬条件惩罚
  // 年龄
  if(candidate['年龄'] && Math.abs(targetPerson.age-candidate['年龄'])>hardConditions['年龄'].maxDiff) score*=hardConditions['年龄'].factor;
  // 身高
  if(candidate['身高'] && candidate['身高']<hardConditions['身高'].min) score*=hardConditions['身高'].factor;
  // 居住城市
  if(candidate['居住城市'] && candidate['居住城市']!==hardConditions['居住城市'].value) score*=hardConditions['居住城市'].factor;

  return score;
}

function scoreToColor(score){ const hue=Math.min(Math.max(score*1.2,0),120); return `hsl(${hue},70%,50%)`; }

function updateDashboard(){
  const rows=document.querySelectorAll("#candidatesTable tbody tr");
  const candidates=[];
  rows.forEach(row=>{
    const candidate={name:row.cells[0].querySelector('input').value};
    dimensions.forEach((dim,i)=>{
      candidate[dim.name]=row.cells[i+1].querySelector('input').value;
    });
    candidates.push(candidate);
  });

  // 计算匹配度
  const results=candidates.map(c=>{
    const scores=calculateScores(c);
    const total=calculateTotal(scores,c);
    return {...c,scores,total};
  });

  // 排序
  results.sort((a,b)=>b.total-a.total);

  // 显示
  const dashboard=document.getElementById('dashboard');
  dashboard.innerHTML='';
  charts.forEach(c=>c.destroy());
  charts=[];

  results.forEach(r=>{
    const card=document.createElement('div');
    card.className='card';
    card.style.background=scoreToColor(r.total);
    card.innerHTML=`<h4>${r.name}</h4><div class="score">匹配度: ${r.total.toFixed(1)}%</div><canvas></canvas>`;
    dashboard.appendChild(card);

    const ctx=card.querySelector('canvas').getContext('2d');
    const chart=new Chart(ctx,{
      type:'bar',
      data:{ labels:dimensions.map(d=>d.name), datasets:[{label:'贡献分', data:dimensions.map(d=>r.scores[d.name]*parseFloat(document.getElementById(`weight_${d.name}`).value)), backgroundColor:'rgba(0,200,100,0.6)'}] },
      options:{ responsive:true, plugins:{legend:{display:false}}, scales:{y:{beginAtZero:true}} }
    });
    charts.push(chart);
  });
}

// 初始化
initSliders();
addCandidate('小红');
addCandidate('小明');
addCandidate('小丽');
</script>
</body>
</html>
