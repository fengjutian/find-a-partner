<!DOCTYPE html>
<html lang="zh">
<head>
<meta charset="UTF-8">
<title>智能择偶匹配仪表盘</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body { font-family: Arial; padding:20px; background:#f0f2f5; }
h2,h3 { margin-top:20px; }
table { border-collapse: collapse; width:100%; margin-top:10px; }
th,td { border:1px solid #ccc; padding:8px; text-align:center; }
th { background:#eee; }
input { width:100px; }
.weightSlider { width:150px; }
.high { background:#90ee90; }
.mid { background:#ffd700; }
.low { background:#ff6347; }
canvas { background:#fff; border:1px solid #ccc; margin-top:10px; }
</style>
</head>
<body>

<h2>智能择偶匹配仪表盘</h2>

<h3>1. 输入双方信息</h3>
<table>
<tr><th></th><th>年龄</th><th>身高</th><th>城市+房产</th><th>性格</th><th>兴趣</th><th>婚史</th></tr>
<tr>
<td>A自身</td>
<td><input type="number" id="a_age" value="1990"></td>
<td><input type="number" id="a_height" value="170"></td>
<td><input type="text" id="a_cityHouse" value="南京无房"></td>
<td><input type="text" id="a_personality" value="外向,活泼"></td>
<td><input type="text" id="a_interests" value="羽毛球,旅游"></td>
<td><input type="text" id="a_marital" value="未婚"></td>
</tr>
<tr>
<td>A期望</td>
<td><input type="number" id="pa_age" value="1988"></td>
<td><input type="number" id="pa_height" value="175"></td>
<td><input type="text" id="pa_cityHouse" value="南京有房"></td>
<td><input type="text" id="pa_personality" value="大方,包容"></td>
<td><input type="text" id="pa_interests" value="羽毛球,旅游,悬疑电影"></td>
<td><input type="text" id="pa_marital" value="未婚"></td>
</tr>
<tr>
<td>B自身</td>
<td><input type="number" id="b_age" value="1992"></td>
<td><input type="number" id="b_height" value="178"></td>
<td><input type="text" id="b_cityHouse" value="南京有房"></td>
<td><input type="text" id="b_personality" value="大方,幽默"></td>
<td><input type="text" id="b_interests" value="羽毛球,悬疑电影"></td>
<td><input type="text" id="b_marital" value="未婚"></td>
</tr>
<tr>
<td>B期望</td>
<td><input type="number" id="pb_age" value="1989"></td>
<td><input type="number" id="pb_height" value="165"></td>
<td><input type="text" id="pb_cityHouse" value="南京无房"></td>
<td><input type="text" id="pb_personality" value="外向,活泼"></td>
<td><input type="text" id="pb_interests" value="旅游,羽毛球"></td>
<td><input type="text" id="pb_marital" value="未婚"></td>
</tr>
</table>

<h3>2. 条件权重调节</h3>
<table>
<tr><th>条件</th><th>权重</th></tr>
<tr><td>年龄</td><td><input type="range" min="0" max="5" value="1" id="w_age" class="weightSlider"></td></tr>
<tr><td>身高</td><td><input type="range" min="0" max="5" value="1" id="w_height" class="weightSlider"></td></tr>
<tr><td>城市/房产</td><td><input type="range" min="0" max="5" value="1" id="w_cityHouse" class="weightSlider"></td></tr>
<tr><td>性格</td><td><input type="range" min="0" max="5" value="1" id="w_personality" class="weightSlider"></td></tr>
<tr><td>兴趣</td><td><input type="range" min="0" max="5" value="1" id="w_interests" class="weightSlider"></td></tr>
<tr><td>婚史</td><td><input type="range" min="0" max="5" value="1" id="w_marital" class="weightSlider"></td></tr>
</table>

<button onclick="calculateMatch()">计算匹配值</button>

<h3>3. 匹配结果雷达图</h3>
<canvas id="radarChart" width="400" height="400"></canvas>

<h3>4. 综合匹配趋势图</h3>
<canvas id="trendChart" width="600" height="300"></canvas>

<h3>5. 单项条件趋势图</h3>
<canvas id="conditionTrendChart" width="600" height="300"></canvas>

<h3>6. 匹配差异与建议</h3>
<table id="diffTable">
<thead><tr><th>条件</th><th>A对B匹配</th><th>B对A匹配</th><th>综合匹配(%)</th><th>差异/建议</th></tr></thead>
<tbody></tbody>
<tfoot>
<tr><td colspan="3">总匹配度</td><td id="totalScore">0</td><td></td></tr>
</tfoot>
</table>

<script>
const conditions=[
  {name:'age',type:'numeric'},
  {name:'height',type:'numeric'},
  {name:'cityHouse',type:'categorical'},
  {name:'personality',type:'text'},
  {name:'interests',type:'text'},
  {name:'marital',type:'categorical'}
];

let trendData=[];
let conditionTrendData={};
conditions.forEach(c=>conditionTrendData[c.name]=[]);

let radarChart=null;
let trendChart=null;
let conditionTrendChart=null;

function numericScore(val,target,tolerance=5){
  const diff=Math.abs(val-target);
  return diff>=tolerance?0:(1-diff/tolerance);
}

function textScore(a,b){
  const setA=new Set(a.split(',').map(s=>s.trim()));
  const setB=new Set(b.split(',').map(s=>s.trim()));
  const inter=new Set([...setA].filter(x=>setB.has(x)));
  const union=new Set([...setA,...setB]);
  return union.size>0?inter.size/union.size:0;
}

function scoreColor(score){
  if(score>0.7) return 'high';
  if(score>0.4) return 'mid';
  return 'low';
}

function getWeight(f){ return +document.getElementById('w_'+f).value; }

function calculateConditionScore(val,target,type){
  if(type==='numeric') return numericScore(val,target);
  if(type==='categorical'){
    if(val.includes(target.split('有')[0]) && val.includes('有房')===target.includes('有房')) return 1;
    if(val.includes(target.split('有')[0])) return 0.5;
    return 0;
  }
  if(type==='text') return textScore(target,val);
  return 0;
}

function calculateMatch(){
  const A={age:+document.getElementById('a_age').value,height:+document.getElementById('a_height').value,cityHouse:document.getElementById('a_cityHouse').value,personality:document.getElementById('a_personality').value,interests:document.getElementById('a_interests').value,marital:document.getElementById('a_marital').value};
  const PA={age:+document.getElementById('pa_age').value,height:+document.getElementById('pa_height').value,cityHouse:document.getElementById('pa_cityHouse').value,personality:document.getElementById('pa_personality').value,interests:document.getElementById('pa_interests').value,marital:document.getElementById('pa_marital').value};
  const B={age:+document.getElementById('b_age').value,height:+document.getElementById('b_height').value,cityHouse:document.getElementById('b_cityHouse').value,personality:document.getElementById('b_personality').value,interests:document.getElementById('b_interests').value,marital:document.getElementById('b_marital').value};
  const PB={age:+document.getElementById('pb_age').value,height:+document.getElementById('pb_height').value,cityHouse:document.getElementById('pb_cityHouse').value,personality:document.getElementById('pb_personality').value,interests:document.getElementById('pb_interests').value,marital:document.getElementById('pb_marital').value};

  const tbody=document.querySelector('#diffTable tbody');
  tbody.innerHTML='';
  let totalScoreSum=0;
  let radarLabels=[], radarA=[], radarB=[], radarC=[];
  const totalWeight=conditions.reduce((a,c)=>a+getWeight(c.name),0);

  conditions.forEach(c=>{
    const weight=getWeight(c.name);
    let scoreA=calculateConditionScore(B[c.name],PA[c.name],c.type);
    let scoreB=calculateConditionScore(A[c.name],PB[c.name],c.type);
    const combined=(scoreA*weight+scoreB*weight)/(2*weight);
    totalScoreSum+=combined*weight;

    radarLabels.push(c.name);
    radarA.push(scoreA*100);
    radarB.push(scoreB*100);
    radarC.push(combined*100);

    trendData.push(totalScoreSum/totalWeight*100);
    conditionTrendData[c.name].push(combined*100);

    let diff='';
    if(scoreA<1) diff+=`A期望:${PA[c.name]},B:${B[c.name]}. `;
    if(scoreB<1) diff+=`B期望:${PB[c.name]},A:${A[c.name]}. `;

    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${c.name}</td>
      <td class="${scoreColor(scoreA)}">${(scoreA*100).toFixed(1)}%</td>
      <td class="${scoreColor(scoreB)}">${(scoreB*100).toFixed(1)}%</td>
      <td class="${scoreColor(combined)}">${(combined*100).toFixed(1)}%</td>
      <td>${diff}</td>`;
    tbody.appendChild(tr);
  });

  const totalScore=(totalScoreSum/totalWeight)*100;
  document.getElementById('totalScore').innerText=totalScore.toFixed(1)+'%';

  // 雷达图
  if(radarChart) radarChart.destroy();
  const ctx=document.getElementById('radarChart').getContext('2d');
  radarChart=new Chart(ctx,{
    type:'radar',
    data:{labels:radarLabels,datasets:[
      {label:'A对B匹配', data:radarA, borderColor:'blue', fill:false},
      {label:'B对A匹配', data:radarB, borderColor:'green', fill:false},
      {label:'综合匹配', data:radarC, borderColor:'red', fill:false}
    ]},
    options:{responsive:true, scales:{r:{beginAtZero:true,max:100}}}
  });

  // 综合趋势图
  if(trendChart) trendChart.destroy();
  const ctx2=document.getElementById('trendChart').getContext('2d');
  trendChart=new Chart(ctx2,{
    type:'line',
    data:{labels:trendData.map((v,i)=>i+1),datasets:[{label:'综合匹配度趋势',data:trendData,borderColor:'purple',fill:false,tension:0.2}]},
    options:{responsive:true,scales:{y:{beginAtZero:true,max:100},x:{title:{display:true,text:'计算次数'}}}}
  });

  // 单项条件趋势图
  if(conditionTrendChart) conditionTrendChart.destroy();
  const ctx3=document.getElementById('conditionTrendChart').getContext('2d');
  conditionTrendChart=new Chart(ctx3,{
    type:'line',
    data:{
      labels:trendData.map((v,i)=>i+1),
      datasets:conditions.map(c=>({
        label:c.name,
        data:conditionTrendData[c.name],
        borderColor:'#'+Math.floor(Math.random()*16777215).toString(16),
        fill:false,
        tension:0.2
      }))
    },
    options:{responsive:true,scales:{y:{beginAtZero:true,max:100},x:{title:{display:true,text:'计算次数'}}}}
  });
}
</script>

</body>
</html>
